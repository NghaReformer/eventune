---
/**
 * Toast Component
 * Notification messages with auto-dismiss
 */

interface Props {
  id?: string;
  variant?: 'success' | 'error' | 'warning' | 'info';
  duration?: number;
  dismissible?: boolean;
  class?: string;
}

const {
  id = 'toast-container',
  variant = 'info',
  duration = 5000,
  dismissible = true,
  class: className = '',
} = Astro.props;

const variants = {
  success: 'bg-status-success/20 border-status-success text-status-success',
  error: 'bg-status-error/20 border-status-error text-status-error',
  warning: 'bg-status-warning/20 border-status-warning text-status-warning',
  info: 'bg-status-info/20 border-status-info text-status-info',
};

const icons = {
  success: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>`,
  error: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>`,
  warning: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>`,
  info: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
};
---

<!-- Toast Container -->
<div
  id={id}
  class="fixed bottom-4 right-4 z-50 space-y-2 pointer-events-none"
  data-toast-container
  data-duration={duration}
  data-dismissible={dismissible}
>
</div>

<!-- Toast Template -->
<template id="toast-template">
  <div
    class={`flex items-start gap-3 p-4 rounded-lg border shadow-lg pointer-events-auto max-w-sm animate-slide-in ${className}`}
    role="alert"
    data-toast
  >
    <div data-toast-icon></div>
    <div class="flex-1">
      <p data-toast-title class="font-medium"></p>
      <p data-toast-message class="text-sm opacity-80"></p>
    </div>
    <button
      type="button"
      class="p-1 rounded hover:bg-white/10 transition-colors"
      data-toast-dismiss
      aria-label="Dismiss"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
</template>

<script>
  interface ToastOptions {
    title?: string;
    message: string;
    variant?: 'success' | 'error' | 'warning' | 'info';
    duration?: number;
  }

  const variants: Record<string, string> = {
    success: 'bg-status-success/20 border-status-success text-status-success',
    error: 'bg-status-error/20 border-status-error text-status-error',
    warning: 'bg-status-warning/20 border-status-warning text-status-warning',
    info: 'bg-status-info/20 border-status-info text-status-info',
  };

  const icons: Record<string, string> = {
    success: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>',
    error: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>',
    warning: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>',
    info: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>',
  };

  function showToast(options: ToastOptions) {
    const container = document.querySelector('[data-toast-container]');
    const template = document.getElementById('toast-template') as HTMLTemplateElement;

    if (!container || !template) return;

    const defaultDuration = parseInt(container.getAttribute('data-duration') || '5000');
    const variant = options.variant || 'info';
    const duration = options.duration ?? defaultDuration;

    const clone = template.content.cloneNode(true) as DocumentFragment;
    const toast = clone.querySelector('[data-toast]') as HTMLElement;

    if (!toast) return;

    // Apply variant styles
    toast.className = `flex items-start gap-3 p-4 rounded-lg border shadow-lg pointer-events-auto max-w-sm animate-slide-in ${variants[variant]}`;

    // Set icon
    const iconEl = toast.querySelector('[data-toast-icon]');
    if (iconEl) iconEl.innerHTML = icons[variant];

    // Set content
    const titleEl = toast.querySelector('[data-toast-title]');
    const messageEl = toast.querySelector('[data-toast-message]');

    if (titleEl) {
      if (options.title) {
        titleEl.textContent = options.title;
      } else {
        titleEl.remove();
      }
    }

    if (messageEl) {
      messageEl.textContent = options.message;
    }

    // Dismiss button
    const dismissBtn = toast.querySelector('[data-toast-dismiss]');
    if (dismissBtn) {
      dismissBtn.addEventListener('click', () => {
        toast.classList.add('animate-slide-out');
        setTimeout(() => toast.remove(), 200);
      });
    }

    container.appendChild(clone);

    // Auto dismiss
    if (duration > 0) {
      setTimeout(() => {
        toast.classList.add('animate-slide-out');
        setTimeout(() => toast.remove(), 200);
      }, duration);
    }
  }

  // Expose globally
  (window as any).showToast = showToast;
</script>

<style>
  @keyframes slide-in {
    from {
      opacity: 0;
      transform: translateX(100%);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes slide-out {
    from {
      opacity: 1;
      transform: translateX(0);
    }
    to {
      opacity: 0;
      transform: translateX(100%);
    }
  }

  .animate-slide-in {
    animation: slide-in 0.2s ease-out forwards;
  }

  .animate-slide-out {
    animation: slide-out 0.2s ease-in forwards;
  }
</style>
